load examples.mat
imgdir = './images/';
%display a random image
%figure 

count_train = 0;
count_test = 0;
for i = 1:10%length(examples)
    
    length(examples) - i

 
    img = imread([imgdir,'/',examples(i).filepath]);
    [nl, nc,~] = size(img);
    
    xmin = min(examples(i).coords(1,:)) ;
    xmin = xmin - 0.2*xmin;
    if xmin < 0
        xmin = 0;
    end
    
    xmax = max(examples(i).coords(1,:));
    xmax = xmax + 0.2*xmax;
    if xmax > nc
        xmax = nc;
    end
    
    ymin = min(examples(i).coords(2,:));
    ymin = ymin - 0.5*ymin;
    if ymin < 0
        ymin = 0;
    end
    
    ymax = max(examples(i).coords(2,:));
    ymax = ymax + 0.3*ymax;
    if ymax > nl
        ymax = nl;
    end
    
    dx = xmax - xmin;
    dy = ymax - ymin;
    
    cla
    crop = imcrop(img,[xmin,ymin,dx,dy]);
    
    new_x = examples(i).coords(1,:) - xmin;
    new_y = examples(i).coords(2,:) - ymin;
    pos = [new_x ; new_y];
    
   
    imagens{i} = crop;
    locations{i} = pos;
    
    for j = 1:length(pos)
       if pos(1,j)' >  0
         crop = insertMarker(crop,pos(:,j)');
       end
    end
    
    
    
    if examples(i).istrain == 1
        savepath = strcat('train_data/images/frame',int2str(count_train),'.jpg');
        
        imwrite(crop,savepath);
        count_train = count_train + 1;
    
    else 
        savepath = strcat('test_data/images/frame',int2str(count_test),'.jpg');
       
        imwrite(crop,savepath);
        count_train = count_train + 1;
 
    end
    
    

    
    %imshow(crop);
    %waitforbuttonpress;
    %cla, imagesc(img), axis image, hold on;
    


end